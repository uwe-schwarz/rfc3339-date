import { readFileSync, unlinkSync, writeFileSync } from "node:fs";
import { execSync } from "node:child_process";
import { join } from "node:path";

const cwd = process.cwd();
const input = join(cwd, "src/styles/tailwind.css");
const output = join(cwd, ".tailwind.generated.css");
const generatedTs = join(cwd, "src/lib/tailwind.generated.ts");

execSync(`pnpm exec tailwindcss -i "${input}" -o "${output}" --minify`, {
  cwd,
  stdio: "inherit",
});

const css = readFileSync(output, "utf8");
const banner = "// Generated by scripts/build-tailwind.mjs. Do not edit manually.\n";
writeFileSync(generatedTs, `${banner}export const TAILWIND_CSS = ${JSON.stringify(css)};\n`);
unlinkSync(output);

console.log(`Generated ${generatedTs}`);
